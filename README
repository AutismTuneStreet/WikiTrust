WikiTrust can be used to assign text trust and author reputation in
real-time, as edits to a wiki are made.  Text trust is displayed via
different colors for the text background, from dark orange (low trust)
to white (maximum trust).  The colors can be easily changed by
changing a skin file. 

The extension can be added to an existing wiki, or to a new one. 
If the extension is added to a new wiki, it will start computing
reputations and trusts as soon as someone makes an edit, or requests
to view a trust-colored revision.  The reputation and trust
computation takes some time, after which the coloring is available. 
If you switch the extension off, then on, the extension will compute
the missing reputation and trust values in a self-healing,
fault-tolerant fashion. 


PREREQUISITES: 

1) Install mysql and mediawiki.  In Ubuntu / Debian, you can install
   the packages: 

     mediawiki
     mysql-server
     mysql-client
     tidy

   In other distributions, follow the instructions at
   www.mediawiki.org. 

2) We need now to install some packages for Ocaml.  The best way is to
   use godi (http://godi.camlcity.org), as this enables you to build
   everything in userspace. 

   Get godi from http://godi.camlcity.org/godi/index.html and download
   godi. Follow the instructions to install it. For Windows, look at
   the instructions in the godi README file.
   Install the following Ocaml packages from godi:

          godi-extlib
          godi-findlib
          godi-ocaml-mysql
	  godi-sexplib
	  godi-type-conv

   If you do not wish to use godi, you can get the above packages
   either from their source, or from the linux distribution you are
   using. 

3) Make OcamlLdaLibs and install them. 
   If you can install without sudo rights: 
      $ make all
   If you did not use godi: 
      $ make all-sudo


INSTALLATION:

1) First, compile the code: 

  $ make clean ; make all ; make allopt

This creates an eval_online_wiki executable, which is what computes
text trust and origin, and author reputation, in a wiki.  The
executable is called whenever someone edit the wiki, or wishes to see
a trust-colored version of a page. 

2) Second, we need to create the database tables that the trust
coloring extension will use.  Assuming that the mediawiki database is
called  "wikidb" (this is the default name: you give a name to the
database when you create the wiki instance during the MediaWiki
installation process), proceed as follows. 

  2a) edit remove_wikitrust_tables.sql and
      create_wikitrust_tables.sql, inserting the correct database user
      name where needed.

  2b) Assuming that the mediawiki database is called wikidb, do: 

      $ cd sql
      $ mysql -u root -p wikidb
      mysql> \. remove_wikitrust_tables.sql
      mysql> \. create_wikitrust_tables.sql
      mysql> \q


3) Next, you need to install the trust coloring extension in
mediawiki.  There are two ways to do this:

3a) Leaving the files in place, and using symbolic links.  This is the
preferred course of action: in this way, when we release bug fixes via
git, you can simply update your version of WikiTrust, recompile the
code if needed (most likely), and be done with it.  In alternative 3b)
below, you would need to then copy the new files to appropriate
places. 

To build symbolic links in Ubuntu you can proceed as follows (the
process is similar for other distributions; only the destination
directory path may be different): 

  $ cd /var/lib/mediawiki/extensions 
  $ sudo ln -s /home/username/wikitrust/mediawiki/extensions/Trust .

3b) Alternatively, use 'cp' statements rather than symbolic links. 

4) Finally, you should activate the extension by editing
LocalSettings.php (part of the MediaWiki installation), adding the
following lines: 

  # Trust extension	
  $wgUseTidy = true;
  $wgTrustCmd = "/home/username/wikitrust/analysis/eval_online_wiki"; 
  $wgTrustLog = "/somedir/{$wgDBname}-trust.log";
  $wgTrustDebugLog = "/somedir/{$wgDBname}-trust-debug.log";
  $wgRepSpeed = 1.0;
  $wgTrustTabText = "check text";
  $wgTrustExplanation = '{| border="1" cellpadding="5" cellspacing="0" style="background:lightgreen; color:b\
lack"
|-
| The above text is colored according to how much it has been revised.  An orange background indicates new\
, unrevised, text;  white is for text that has been revised by many reputed authors.  The colors are compu\
ted by [http://trust.cse.ucsc.edu/WikiTrust WikiTrust].
|-
| If you click on a word, you will be redirected to the diff corresponding to the edit where the word was \
introduced.
|}';

  require_once( $IP . "/extensions/Trust/ExtensionClass.php");
  require_once( $IP . "/extensions/Trust/Trust.php" );

And make the installation readable from the Web server, if you use
method 3a): 

  $ chmod -R a+rX /home/username/wikitrust

Above, we are requesting that two logs be created: 

  $wgTrustLog = "/somedir/{$wgDBname}-trust.log";

This creates a log of the analysis of how useful each contribution to
the wiki is, as well as a log of all user reputation changes. 
We advise you to create such a log: it contains very useful
information, and it is likely that we will develop a variety of tools
to extract the information present.  You don't want to miss out.  Note
that you are responsible for rotating / compressing the log (e.g., via
logrotate, or /etc/logrotate.conf or /etc/logrotate.d/

On the other hand, the log requested via 

  $wgTrustDebugLog = "/somedir/{$wgDBname}-trust-debug.log";

is just useful to us to track down bugs and other problems, and can be
safely disabled.  You can disable these logs via: 

  $wgTrustLog = "/dev/null";
  $wgTrustDebugLog = "/dev/null";


DEPLOYMENT: 

You should now see a trust tab.  Click on it, or edit a revision, and
the trust of all revision text, and the reputation of all authors,
will be computed. 


COMPUTING THE TRUST COLORING:

The trust coloring is computed automatically whenever a user edits an
article, or requests to view the trust informaton for a revision.  In
particular, when a user edits an article, or when someone asks to view
the trust information, WikiTrust computes the trust coloring not only
for the newest revision, but for all past revisions of all wiki
articles that have not been colored yet.

You can also compute the trust coloring from the command line, via the
command: 

  $ ./eval_online_wiki -n_revs 1000 -db_user <username> -db_pass <pwd> -db_name <db_name>

eval_online_wiki computes trust for all revisions for which the trust
information has not been computed yet.  The parameter -n_revs
specifies the maximum number of revisions that are analyzed. 
If you are interested in all the command-line options of
eval_online_wiki, you can type: 

  $ ./eval_online_wiki -help


RECOMPUTING THE TRUST COLORING:

It is possible at any time to recompute from scratch the trust
coloring of a wiki.  This can be useful, for instance, when some bug
in the coloring code has been corrected, or when some new feature has
been added. 
Obviously, this recomputation can be a time-consuming process on large
wikis. 
The command is: 

  $ ./eval_online_wiki -delete_all -n_revs 1000000 -db_user <username> -db_pass <pwd>  -db_name <db_name>

Typical values for these parameters are: 
username: wikiuser
db_name: wikidb


BATCH MODE:

The tool has also a batch mode, useful for computing statistical
quantities of a wiki.  Please see batch/README for more information.
