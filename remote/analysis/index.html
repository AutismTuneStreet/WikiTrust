
<% $result %>

<%init>

my $dbh = DBI->connect(
  $ENV{WT_DBNAME},
  $ENV{WT_DBUSER},
  $ENV{WT_DBPASS}
);

my $result = "";

if ($vote eq ""){
  $result = WikiTrust::handle_vote($rev, $page, $user, $time, $page_title, 
      $dbh);
} elsif ($edit eq "") {
  $result = WikiTrust::handle_edit($rev, $page, $user, $time, $page_title, 
      $dbh);
} else {
  $result = WikiTrust::handle_text_request($rev, 
      $page, $user, $time, $page_title, $dbh);
}

</%init>

<%args>
  $page
  $page_title
  $rev => -1
  $time => ""
  $user => -1
  $vote => -1
  $edit => -1
</%args>

<%filter>
## Compress the output if the client accepts it.
if ($r->headers_in->{'Accept-Encoding'} =~ /((?:x-)?gzip)/) {
  $r->content_encoding($1);
  $_ = Compress::Zlib::memGzip($_);
}

</%filter>