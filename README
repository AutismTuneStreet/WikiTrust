WikiTrust is a MediaWiki extension that computes in real time the
reputation of wiki authors, and the trust of wiki text.  Text trust is
displayed via different colors for the text background, from dark
orange (low trust) to white (maximum trust).  The colors can be easily
changed by changing a skin file.  WikiTrust also computes, for each
word of text, the author of the word, and the revision where the word
was first inserted.  When clicking on a word, the user is sent to the
revision diff where the word was added.  When hovering with the mouse
over a word, a pop-up displays the name of the word's author.

The WikiTrust extension can be added to an existing wiki, or to a new
one.  If the extension is added to a new wiki, it will start computing
reputations and trusts as soon as someone makes an edit, or requests
to view a trust-colored revision.  The reputation and trust
computation takes some time, after which the coloring is available.
If you switch the extension off, then on, the extension will compute
the missing reputation and trust values in a self-healing,
fault-tolerant fashion.


AUTHORS:

The main developers are: 

- Luca de Alfaro (lda@dealfaro.com)
- Ian Pye (ipye@gmail.com)
- Bo Adler (thumper@alumni.caltech.edu)

Other contributors:

- Krishnendu Chatterjee (krish.chat@gmail.com)


REMOTE INSTALLATION

We describe in this README file the use of WikiTrust as a MediaWiki
extension.  
Installation instructions for the MWF are given in README-WMF.


PREREQUISITES: 

1) Install mysql and mediawiki.  In Ubuntu / Debian, you can install
   the packages: 

     mediawiki
     php5-cli
     mysql-server
     mysql-client
     tidy

   In other distributions, follow the instructions at
   www.mediawiki.org. 


================================================================

THE FAST WAY: 

We provide a statically-linked executable, which is built under
Ubuntu, but should work under many versions of linux. 
If you are happy using it, then you can use these abbreaviated
instructions.  Otherwise, see at the bottom of this file for an
alternative to step 2) below, which involves compiling
eval_online_wiki from source. 

2) Take a deep breath. 

3) Next, you need to install the trust coloring extension in
   mediawiki.  You can install it in
   /var/lib/mediawiki/extensions/WikiTrust
   with
   cp -r wikitrust /var/lib/mediawiki/extensions/WikiTrust

4) You should activate the extension by editing
   LocalSettings.php (part of the MediaWiki installation), adding the
   following lines: 

$wgUseTidy = true;       // Enable Tidy
$wgUseAjax = true;       // Enable Ajax (needed for voting)
require_once( $IP . "/extensions/WikiTrust/Trust.php" );

   Edit Trust/Trust.php, and set the following variables: 

     $wgWikiTrustVersion = "local"; 
  
   This needs to be one of local, remote, wmf.
   Leave it as local, unless you know what you are doing.

     $wgWikiTrustGadget = "gadget-WikiTrust";

   By default the trust tab is selected only by a user opting in.
	 Set this to NULL to make the tab always availible.
   
     $wgWikiTrustShowVoteButton = true; 

   If true, the vote option is enabled. 

   We are requesting that two logs be created: 

     $wgTrustLog = "/somedir/{$wgDBname}-trust.log";

   This creates a log of the analysis of how useful each contribution to
   the wiki is, as well as a log of all user reputation changes. 
   We advise you to create such a log: it contains very useful
   information, and it is likely that we will develop a variety of tools
   to extract the information present.  You don't want to miss out.  Note
   that you are responsible for rotating / compressing the log (e.g., via
   logrotate, or /etc/logrotate.conf or /etc/logrotate.d/
   
   On the other hand, the log requested via 
   
     $wgTrustDebugLog = "/somedir/{$wgDBname}-trust-debug.log";
   
   is just useful to us to track down bugs and other problems, and can be
   safely disabled.  You can disable these logs via: 
   
     $wgTrustLog = "/dev/null";
     $wgTrustDebugLog = "/dev/null";

5) You need to make the installation readable from the web server. 

        $ chmod a+rX /var/lib/mediawiki/extensions/WikiTrust/*.php
        $ chmod -R a+rX /var/lib/mediawiki/extensions/WikiTrust/include
        $ chmod -R a+rX /var/lib/mediawiki/extensions/WikiTrust/css
        $ chmod -R a+rX /var/lib/mediawiki/extensions/WikiTrust/js

   Be careful not to give access to the web server to the other files,
   as there may be obscure security issues associated with, for
   instance, your web server having access to the .git directory (if
   you got wikitrust via git).

6) You need to create the database tables that the trust coloring
   extension will use.  Assuming that the mediawiki database is called
   "wikidb" (this is the default name: you give a name to the database
   when you create the wiki instance during the MediaWiki installation
   process), proceed as follows: 

   $ cd sql
   $ ./create_db.php "path_to_mediawiki" "mysql_root_user_name"

   where path_to_mediawiki is the path to the mediawiki installation
   (such as /usr/share/mediawiki). 
   If you need to remove the tables, before recreating them, the
   command is: 

   $ ./create_db.php "path_to_mediawiki" "mysql_root_user_name" remove

7) If there are already revisions in the wiki, you should first
   analyze their trust, via: 

     $ ./eval_online_wiki -n_revs 1000000 -db_user <username> -db_pass <pwd> -db_name <db_name>

   The '1000000' means that eval_online_wiki will compute the trust of
   at most 1000000 revisions, then stop.  You can repeat the above
   command as many times as needed (or with a larger or smaller bound)
   until all revisions are analyzed for trust; each invocation will
   analyze at most 1000000 additional revisions.  Typical values for
   these parameters are:

     username: wikiuser
     db_name: wikidb

   If you wish to redo the analysis from scratch, throwing away the
   results of previous analyses, you can use the option '-delete_all': 

     $ ./eval_online_wiki -delete_all -n_revs 1000000 -db_user <username> -db_pass <pwd>  -db_name <db_name>

   Warning: the analysis can take a long time on very large wikis, so
   do not use the option '-delete_all' lightly! 

8) You should now see a trust tab.  Click on it, or edit a revision, and
   the trust of all revision text, and the reputation of all authors,
   will be computed.  

   The trust coloring is updated automatically whenever a user edits
   an article, or requests to view the trust informaton for a
   revision.  In particular, when a user edits an article, or when
   someone asks to view the trust information, WikiTrust computes the
   trust coloring not only for the newest revision, but for all past
   revisions of all wiki articles that have not been colored yet.

9) If you wish to upload pages to the wiki from a dump file, go to the
   test-scripts directory, and follow the instructions in the README
   file there. 

================================================================

COMPILING FROM SOURCE

If you like, you can also build the packages from source. 
Follow these instructions in place of step 2) above. 

2a) You need to install some packages for Ocaml.  There are two ways. 

   2a1) The best way is to use godi (http://godi.camlcity.org), as this
        enables you to build everything in userspace.

        Get godi from http://godi.camlcity.org/godi/index.html and
        download godi. Follow the instructions to install it.  Install
        the following Ocaml packages from godi (use godi_console to 
	install them):

          godi-extlib
          godi-findlib
          godi-ocaml-mysql
	  godi-sexplib
	  godi-type-conv
	  godi-zip

   2a2) If you do not wish to use godi, you can get the above packages
        either from their source, or from the linux distribution you
        are using.  For Ubuntu, you can use the following packages:

          ocaml (version 3.10.0 or greater)
          ocaml-base
          ocaml-native-compilers
          ocaml-findlib
          libmysql-ocaml
          libmysql-ocaml-dev
          libextlib-ocaml-dev
          python-mysqldb
	  libxml-light-ocaml-dev	
	  libzip-ocaml-dev

        You also need:

          type-conv
	  sexplib

        Which are available from
        http://www.janestcapital.com/ocaml/index.html .

2b) Make OcamlLdaLibs and install them. 
    If you can install without sudo rights: 
      $ make all
    If you did not use godi, so that you need sudo rights to install: 
      $ make all-sudo

2c) Compile the code: 

      $ make clean ; make all ; make allopt

    This creates an eval_online_wiki executable, which is what
    computes text trust and origin, and author reputation, in a wiki.
    The executable is called whenever someone edit the wiki, or wishes
    to see a trust-colored version of a page.

================================================================

BATCH MODE:

The tool has also a batch mode, useful for computing statistical
quantities of a wiki.  Please see batch/README for more information.
